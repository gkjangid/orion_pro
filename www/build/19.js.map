{"version":3,"sources":["../../src/pages/activity-intro/activity-intro.module.ts","../../src/pages/activity-intro/activity-intro.ts"],"names":[],"mappings":"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","file":"19.js","sourcesContent":["import { NgModule }           from '@angular/core';\nimport { IonicPageModule }    from 'ionic-angular';\nimport { ActivityIntroPage }  from './activity-intro';\nimport { ComponentsModule }   from '../../components/components.module';\n\n@NgModule({\n  declarations: [\n    ActivityIntroPage,\n  ],\n  imports: [\n    ComponentsModule,\n    IonicPageModule.forChild(ActivityIntroPage),\n  ],\n})\nexport class ActivityIntroPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/activity-intro/activity-intro.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { AlertController, Events, Platform }   from 'ionic-angular';\nimport { ApiProvider }  from '../../providers/api/api';\n\n\n@IonicPage()\n@Component({\n  selector:    'page-activity-intro',\n  templateUrl: 'activity-intro.html',\n})\nexport class ActivityIntroPage {\n\n  activity:         any    = {};\n  activityId:       number;\n  appFeatures:      { [name: string] : boolean } = {};\n  lastQuestion:     number = -1;\n  progress:         number = 0;\n  segment:          string = 'info';\n  userActivity:     any    = {};\n\n  constructor(\n    public alertCtrl: AlertController,\n    public api:       ApiProvider,\n    public events:    Events,\n    public navCtrl:   NavController,\n    public navParams: NavParams,\n    public platform:  Platform,\n  ) {\n    this.events.subscribe( 'lastQuestion', lastQuestion => {\n      this.lastQuestion = lastQuestion;\n      this.progress     = this.getProgress();\n      if ( lastQuestion == this.activity.questions.length-1 ){\n        this.segment='info';\n      }\n    });\n  }\n\n  activityJournal(): void {\n    this.navCtrl.push( 'ActivityJournalPage', {\n      activity:     this.activity,\n      userActivity: this.userActivity,\n    })\n  }\n\n  begin(): void {\n    this.segment='questions';\n    this.gotoQuestion( this.lastQuestion + 1, this.activity );\n    this.api.setUserActivityStateStarted( this.activity );\n  }\n\n  canBegin(): boolean {\n    if ( !this.userActivity.start_date ){ return true; }\n    const startDate = new Date( this.userActivity.start_date );\n    return new Date() >= startDate;\n  }\n\n  chat(): void {\n    this.navCtrl.push( 'ChatPage', { userActivity: this.userActivity } );\n  }\n\n  deleteActivity(): void {\n    this.alertCtrl.create({\n      title: 'Confirm deletion',\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel',\n        },\n        {\n          text: 'Delete',\n          handler: () => {\n            this.api.deleteUserActivity( this.userActivity.id )\n              .subscribe( response => {\n                this.removeUserActivity( this.userActivity.activity_id );\n                this.navCtrl.pop();\n              });\n          },\n        },\n      ],\n    }).present();\n  }\n\n  editTeam(): void {\n    this.alertCtrl.create({\n      subTitle: this.userActivity.team? 'Change team': 'Join team',\n      inputs: [\n        {\n          name: 'team',\n          placeholder: 'Team name',\n          value: this.userActivity.team,\n        },\n      ],\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cance;',\n        },\n        {\n          text: 'OK',\n          handler: data => {\n            const team = data.team.trim();\n            this.userActivity.team = team;\n            this.api.setUserActivityTeam( this.userActivity ).subscribe( response => {\n              this.userActivity.team = response.data;\n            });\n          },\n        },\n      ],\n    }).present();\n  }\n\n  featureEnabled( name: string ): boolean {\n    const feature = this.appFeatures [name];\n    if ( feature === undefined ){\n      return true;\n    }\n    return feature;\n  }\n\n  getAppFeatures(): void {\n    this.api.getAppFeature().subscribe( response => {\n      response.data.map( item => {\n        this.appFeatures [item.name] = item.enabled;\n      });\n    });\n  }\n\n  getProgress(): number {\n    if ( this.lastQuestion < 0 ){ return 0; }\n    return Math.round(\n      ( this.lastQuestion + 1 ) / this.activity.questions.length * 100\n    );\n  }\n\n  getUserActivity( activityId: number ): void {\n    this.api.getUserActivities( activityId )\n      .subscribe( data => {\n        this.userActivity = data;\n        this.activity     = this.userActivity.activity.data;\n        this.lastQuestion = this.userActivity.completed_question;\n        this.progress     = this.getProgress();\n      });\n  }\n\n  gotoQuestion( questionIdx: number, activity: any ): void {\n    if ( !this.canBegin() ){ return; }\n    if ( questionIdx > this.lastQuestion + 1 ) { return; }\n    this.navCtrl.push( 'ActivityAnswerPage', {\n      questionIdx:  questionIdx,\n      activity:     activity,\n      lastQuestion: this.lastQuestion,\n      userActivity: this.userActivity,\n      appFeatures:  this.appFeatures,\n    });\n  }\n\n  ionViewDidEnter(){\n    if ( !this.api.user.userId ){\n      this.navCtrl.push( 'LoginPage' );\n      return;\n    }\n    this.activityId = this.navParams.get( 'id' );\n    if ( !this.activityId ) {\n      this.navCtrl.setRoot( 'HomePage' );\n      return;\n    }\n    this.getAppFeatures();\n    this.getUserActivity( this.activityId );\n  }\n\n  ionViewDidLeave(): void {\n    let videos = Array.from( document.querySelectorAll( 'video' ) );\n    videos.map( item => { item.pause() });\n  }\n\n  removeUserActivity( activityId: number ): void {\n    this.api.userActivities = this.api.userActivities\n      .filter( item => item.pk != activityId );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/activity-intro/activity-intro.ts"],"sourceRoot":""}