{"version":3,"sources":["../../src/pages/login/login.module.ts","../../src/pages/login/login.ts"],"names":[],"mappings":"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","file":"10.js","sourcesContent":["import { NgModule }         from '@angular/core';\nimport { IonicPageModule }  from 'ionic-angular';\nimport { LoginPage }        from './login';\nimport { ComponentsModule } from '../../components/components.module';\n\n@NgModule({\n  declarations: [\n    LoginPage,\n  ],\n  imports: [\n    ComponentsModule,\n    IonicPageModule.forChild(LoginPage),\n  ],\n})\nexport class LoginPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.module.ts","import { Component }          from '@angular/core';\nimport { Http }               from '@angular/http';\nimport { Observable }         from 'rxjs';\nimport { SettingsProvider }   from '../../providers/settings/settings';\nimport { IonicPage, Events, NavController, NavParams }  from 'ionic-angular';\n\n\n@IonicPage()\n@Component({\n  selector:    'page-login',\n  templateUrl: 'login.html',\n})\nexport class LoginPage {\n\n  readonly groups: string[] = [\n\n  ];\n\n  errorMsg:       string;\n  eventDelay:     number  = 1000;\n  homePage:       string  = 'HomePage';\n  httpOptions:    object  = { withCredentials: true };\n  loginExpiry:    number  = 1000*60*60*24; // 1 day\n  showLogin:      boolean = false;\n  showRegister:   boolean = true;\n  password:       string;\n  username:       string;\n\n  constructor(\n    private events:       Events,\n    private http:         Http,\n    private navCtrl:      NavController,\n    private navParams:    NavParams,\n    private settings:     SettingsProvider,\n  ) { }\n\n  chkAccess( user: any ): boolean {\n\n    if ( user.groups ){\n      if ( this.groups.length == 0 ){  return true; }\n      for ( let group of user.groups ){\n        if ( this.groups.indexOf( group ) != -1 ){\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  gotoNextPage(): void {\n    const next = this.navParams.get( 'next' );\n    if ( next ){\n      const params = this.navParams.get( 'params' ) ||  {};\n      this.navCtrl.setRoot( next, params );\n      return;\n    }\n    if ( this.navCtrl.canGoBack() && this.settings.user.userId ){\n      this.navCtrl.pop().catch( err => {\n        console.error( this.navCtrl.getViews() );\n        this.navCtrl.setRoot( this.homePage );\n      });\n      return;\n    }\n    this.navCtrl.setRoot( this.homePage );\n  }\n\n  ionViewDidEnter() {\n    const user   = this.settings.getSession( 'user' ) || {};\n    const now    = new Date().valueOf();\n\n    if ( user && !this.chkAccess( user ) ){\n      this.settings.clearUser();\n      this.showLogin = true;\n      return;\n    }\n\n    if ( user.userId && now - user.lastLogin < this.loginExpiry ){\n      Object.assign( this.settings.user, user );\n      this.publishEvent( this.settings.user );\n      this.gotoNextPage();\n      return;\n    }\n    this.settings.clearUser();\n    this.showLogin = true;\n  }\n\n  login(): void {\n    this.loginApi( this.username, this.password )\n      .subscribe(\n        data => {\n          this.errorMsg = '';\n          if ( data.change_password ){\n            this.navCtrl.push( 'ChangePasswordPage', { hideBackButton: true } );\n            return;\n          }\n          this.gotoNextPage();\n        },\n        error => {\n          this.errorMsg = `${ error.message || \"Login Error!\" }`;\n          console.log( error );\n        },\n    );\n  }\n\n  loginApi( username: string, password: string ): Observable<any> {\n    const url  = '/api/login/';\n    const data = {\n      username: username,\n      password: password,\n    };\n    return this.post( url, data, {} )\n      .map( data => {\n        if ( !this.chkAccess( data ) ){\n          throw new Error( 'Access Denied' );\n        }\n        if ( !data.email ){\n          throw new Error( 'Access Denied.  Invalid email.' );\n        }\n        if ( data.change_password ){\n          this.settings.clearUser();\n          return data;\n        }\n        Object.assign( this.settings.user, data );\n        this.settings.user.lastLogin = new Date().valueOf();\n        this.settings.saveSession( 'user', this.settings.user );\n        this.publishEvent( this.settings.user );\n        return data;\n      });\n  }\n\n  post( url: string, data: any, options?: object ): Observable<any> {\n    let postData = new FormData();\n    for ( let key in data ){\n      postData.append( key, data[ key ] );\n    }\n    return this.http.post( url, postData, options || this.httpOptions )\n      .map( response => {\n        return response.json()\n      });\n  }\n\n  publishEvent( user ): void {\n    setTimeout( () => {\n      this.events.publish( 'login', user )\n    }, this.eventDelay );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.ts"],"sourceRoot":""}