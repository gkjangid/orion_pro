{"version":3,"sources":["../../src/pages/chat/chat.module.ts","../../src/pages/chat/chat.ts"],"names":[],"mappings":"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","file":"15.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ChatPage } from './chat';\n\n@NgModule({\n  declarations: [\n    ChatPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ChatPage),\n  ],\n})\nexport class ChatPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/chat.module.ts","import { Component, ViewChild } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { Content, AlertController }            from 'ionic-angular';\nimport { ApiProvider }       from '../../providers/api/api';\nimport { SettingsProvider }  from '../../providers/settings/settings';\nimport { WebsocketProvider } from '../../providers/websocket';\n\ninterface IMessage {\n  fromUser:     string,\n  message:      string,\n  team?:        string,\n  toUserId?:    number,\n}\n\ninterface ISegment {\n  label: string,\n  value: string,\n}\n\n\n@IonicPage()\n@Component({\n  selector:    'page-chat',\n  templateUrl: 'chat.html',\n})\nexport class ChatPage {\n\n  @ViewChild( Content ) content: Content;\n\n  allMessages:  IMessage[] = [];\n  forumId:      string;\n  invitation:   any;\n  message:      string;\n  messages:     IMessage[] = [];\n  segment:      string = 'activity';\n  segments:     ISegment[] = [\n    { label: 'Activity', value: 'activity' },\n    { label: 'Team',     value: 'team' },\n  ];\n  showSpinner:   boolean = true;\n  team:          string;\n  teams:         string[] = [];\n  title:         string;\n  userActivity:  any;\n\n\n  constructor(\n    public alertCtrl: AlertController,\n    public api:       ApiProvider,\n    public navCtrl:   NavController,\n    public navParams: NavParams,\n    public settings:  SettingsProvider,\n    public websocket: WebsocketProvider,\n  ){}\n\n  changeTeam(): void {\n\n    const getInputs = () => {\n      return this.teams.map( item => {\n        return {\n          type:    'radio',\n          name:    'team',\n          label:   item,\n          value:   item,\n          checked: item == this.team,\n        };\n      })\n    };\n\n    const getButtons = () => {\n      return [\n        {\n          text: 'Cancel',\n          role: 'cancel',\n        },\n        {\n          text: 'OK',\n          handler: team => {\n            this.filterMessages( team );\n          },\n        },\n      ];\n    };\n\n    this.alertCtrl.create({\n      title: 'Select Team',\n      inputs: getInputs(),\n      buttons: getButtons(),\n    }).present();\n  }\n\n  changeSegment( segment: string ): void {\n    if ( segment == 'activity' ){\n      return this.filterMessages( '' );\n    }\n    if ( this.userActivity ){\n      return this.filterMessages( this.userActivity.team );\n    }\n    if ( !this.team ){\n      this.team = this.teams[0];\n    }\n    return this.filterMessages( this.team );\n  }\n\n  filterMessages( team: string ): void {\n    this.team = team;\n    if ( team ){\n      this.messages = this.allMessages.filter( item => item.team == this.team );\n    } else {\n      this.messages = this.allMessages.filter( item => !item.team );\n    }\n    this.scrollToBottom();\n  }\n\n  getChatHistory(): void {\n    const obs = this.userActivity?\n    this.api.getUserActivityChatHistory( this.userActivity.id ) :\n    this.api.getInvitationChatHistory( this.invitation.id );\n    obs.subscribe( data => {\n      this.showSpinner = false;\n      this.allMessages = data;\n      this.changeSegment( 'activity' );\n      this.scrollToBottom();\n    });\n  }\n\n  getforumId(): string {\n    if ( this.invitation ){\n      return this.invitation.id;\n    }\n    let forumId = this.userActivity.invitation_id;\n    if ( this.userActivity.team ){\n      forumId = `${forumId}/team/${ this.userActivity.team }`;\n    }\n    return forumId;\n  }\n\n  getTeams(): string[] {\n    if ( this.invitation ){\n      return this.navParams.get( 'teams' ) || [];\n    }\n    const team = this.userActivity.team;\n    return team? [team] : [];\n  }\n\n  getWebsocket( forumId: string ): void {\n    this.websocket.getForum( forumId ).subscribe( data => {\n      const message: IMessage = JSON.parse( data );\n      this.receivedMessage( message );\n    });\n  }\n\n  ionViewDidEnter() {\n    this.userActivity = this.navParams.get( 'userActivity' );\n    if ( !this.userActivity ){\n      this.invitation = this.navParams.get( 'invitation' );\n      if ( !this.invitation ){\n        this.navCtrl.setRoot( 'HomePage' );\n        return;\n      }\n    }\n    const obj    = this.userActivity || this.invitation;\n    this.title   = obj.activity.title;\n    this.forumId = this.getforumId();\n    this.teams   = this.getTeams();\n    this.getWebsocket( this.forumId );\n    this.getChatHistory();\n  }\n\n  keyup( event: any ): void {\n    if ( event.keyCode == 13 ){\n      this.send();\n    }\n  }\n\n  receivedMessage( message: IMessage ): void {\n    this.allMessages.push( message );\n\n    if ( this.segment == 'activity' ){\n      if ( !message.team ){\n        this.messages.push( message );\n        this.scrollToBottom();\n      }\n      return;\n    }\n\n    if ( this.segment == 'team' ){\n      if ( message.team == this.team ){\n        this.messages.push( message );\n        this.scrollToBottom();\n      }\n      return;\n    }\n  }\n\n  scrollToBottom( delay: number = 100 ): void {\n    setTimeout( () => {\n      if ( this.content ) {\n        try {\n          this.content.scrollToBottom();\n        }\n        catch( e) {\n          console.warn( 'scrollToBottom error' );\n        }\n      }\n    }, delay );\n  }\n\n  send(): void {\n    const message = this.message.trim();\n    if ( !message ){ return; }\n    let data: IMessage = {\n      message,\n      fromUser: this.settings.user.userName,\n      team: this.segment == 'team'? this.team: null,\n    }\n    this.websocket.newMessage( this.forumId, data );\n    this.message = '';\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/chat.ts"],"sourceRoot":""}